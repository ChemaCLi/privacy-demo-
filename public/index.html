<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üê± Demo de Privacidad  üê±</title>
    <meta name="description" content="Demo de Privacidad">
    <meta name="keywords" content="privacidad, seguridad, datos, web, demo, educaci√≥n">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <meta name="google" content="notranslate">
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            margin: 0;
            padding: 20px;
            color: white;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .greeting {
            font-size: 1.3em;
            margin: 20px 0;
            padding: 20px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            color: #ffd700;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.5);
        }

        .name-input {
            margin: 15px 0;
            padding: 10px 15px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
            text-align: center;
        }
        
        .cat-gif {
            width: 100%;
            max-width: 400px;
            border-radius: 15px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            margin: 20px 0;
        }
        
        .status {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            font-weight: bold;
        }
        
        .warning {
            background: rgba(255, 0, 0, 0.2);
            color: #ffcccc;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 0.9em;
        }

        .privacy-section {
            margin-top: 40px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            text-align: left;
        }

        .privacy-title {
            font-size: 1.8em;
            color: #ff6b6b;
            text-align: center;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
        }

        .data-category {
            margin: 20px 0;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
        }

        .data-category h3 {
            color: #4ecdc4;
            margin-top: 0;
            font-size: 1.3em;
        }

        .shared-data {
            border-left: 4px solid #ff6b6b;
        }

        .local-data {
            border-left: 4px solid #95e1d3;
        }

        .data-list {
            list-style: none;
            padding: 0;
        }

        .data-list li {
            background: rgba(255, 255, 255, 0.1);
            margin: 5px 0;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 0.9em;
        }

        .data-value {
            color: #ffd700;
            font-weight: bold;
        }

        .data-description {
            color: #ccc;
            font-size: 0.85em;
            font-style: italic;
        }

        .critical {
            background: rgba(255, 107, 107, 0.3) !important;
        }

        .moderate {
            background: rgba(255, 193, 7, 0.3) !important;
        }

        .low {
            background: rgba(40, 167, 69, 0.3) !important;
        }

        .real-time-data {
            margin-top: 20px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            padding: 15px;
        }

        .data-counter {
            font-size: 1.2em;
            color: #ff6b6b;
            font-weight: bold;
            text-align: center;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üê± Demo de Privacidad  üê±</h1>
        
        <div class="greeting" id="greeting">
            <div>¬°Hola!</div>
            <div style="margin-top: 10px; font-size: 0.9em;">
              Esta p√°gina aunque parece un encantador sitio con GIFs de gatos, est√° recopilando muchos de tus datos.
            </div>
        </div>
        
        <div class="warning">
          Estos datos son recopilados por un servidor y pueden ser compartidos con terceros.
          Contin√∫a navegando para ver c√≥mo se recopilan estos datos.
        </div>
        
        <img src="https://media.giphy.com/media/JIX9t2j0ZTN9S/giphy.gif" 
             alt="GIF Divertido de Gato" 
             class="cat-gif"
             onerror="this.src='https://media.giphy.com/media/mlvseq9yvZhba/giphy.gif'">
        
        <div class="status" id="status">

        </div>
        
        <div class="status" id="data-status">
            Recopilando datos del usuario para la demo...
        </div>

        <!-- Privacy Information Section -->
        <div class="privacy-section">
            <div class="privacy-title">
                üîç An√°lisis de Privacidad en Tiempo Real
            </div>
            
            <div class="data-counter">
                üìä Datos enviados al servidor: <span id="shared-count">0</span>
            </div>

            <div class="data-category shared-data">
                <h3>üö® Datos Compartidos con el Servidor</h3>
                <p style="color: #ffcccc; font-size: 0.9em; margin-bottom: 15px;">
                    Los siguientes datos han sido enviados autom√°ticamente al servidor sin tu consentimiento expl√≠cito:
                </p>
                <ul class="data-list" id="shared-data-list">
                    <!-- Ser√° poblado din√°micamente -->
                </ul>
            </div>

            <div class="data-category local-data">
                <h3>üîí Datos Locales (Solo en tu navegador)</h3>
                <p style="color: #ccffcc; font-size: 0.9em; margin-bottom: 15px;">
                    Estos datos se mantienen en tu dispositivo, pero podr√≠an ser accedidos por scripts maliciosos:
                </p>
                <ul class="data-list" id="local-data-list">
                    <!-- Ser√° poblado din√°micamente -->
                </ul>
            </div>

            <div class="real-time-data">
                <h3 style="color: #4ecdc4; margin-top: 0;">üì° Monitoreo en Tiempo Real</h3>
                <div class="data-list">
                    <div class="data-list">
                        <div style="background: rgba(255, 255, 255, 0.1); margin: 5px 0; padding: 8px 12px; border-radius: 5px; font-size: 0.9em;">
                            üñ±Ô∏è <strong>√öltimo clic:</strong> <span id="last-click" class="data-value">Esperando interacci√≥n...</span>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.1); margin: 5px 0; padding: 8px 12px; border-radius: 5px; font-size: 0.9em;">
                            üìú <strong>Posici√≥n de scroll:</strong> <span id="current-scroll" class="data-value">0px</span>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.1); margin: 5px 0; padding: 8px 12px; border-radius: 5px; font-size: 0.9em;">
                            ‚è∞ <strong>Tiempo en p√°gina:</strong> <span id="time-on-page" class="data-value">0 segundos</span>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.1); margin: 5px 0; padding: 8px 12px; border-radius: 5px; font-size: 0.9em;">
                            üìê <strong>Tama√±o de ventana:</strong> <span id="window-size" class="data-value">Calculando...</span>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.1); margin: 5px 0; padding: 8px 12px; border-radius: 5px; font-size: 0.9em;">
                            üé® <strong>Canvas fingerprint:</strong> <span id="canvas-fingerprint" class="data-value">Generando...</span>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.1); margin: 5px 0; padding: 8px 12px; border-radius: 5px; font-size: 0.9em;">
                            üé• <strong>Dispositivos conectados:</strong> <span id="connected-devices" class="data-value">Detectando...</span>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.1); margin: 5px 0; padding: 8px 12px; border-radius: 5px; font-size: 0.9em;">
                            üìç <strong>Ubicaci√≥n GPS:</strong> <span id="gps-location" class="data-value">Solicitando permisos...</span>
                        </div>
                        <div style="background: rgba(255, 255, 255, 0.1); margin: 5px 0; padding: 8px 12px; border-radius: 5px; font-size: 0.9em;">
                            üìà <strong>Eventos capturados:</strong> <span id="events-captured" class="data-value">0</span>
                        </div>
                    </div>
                </div>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: rgba(255, 255, 255, 0.1); border-radius: 10px; text-align: center;">
                <h3 style="color: #ff6b6b; margin-top: 0;">‚ö†Ô∏è Reflexi√≥n sobre Privacidad</h3>
                <p style="font-size: 0.95em; line-height: 1.6;">
                    Esta demo muestra cu√°ntos datos pueden ser recopilados autom√°ticamente por un sitio web sin que te des cuenta. 
                    En la vida real, estos datos podr√≠an ser utilizados para crear un perfil detallado de tu comportamiento, 
                    preferencias y h√°bitos de navegaci√≥n.
                </p>
                <p style="font-size: 0.9em; color: #ffd700; margin-top: 15px;">
                    <strong>üí° Consejo:</strong> Siempre revisa las pol√≠ticas de privacidad y utiliza herramientas de protecci√≥n 
                    como bloqueadores de anuncios, VPNs y navegadores centrados en la privacidad.
                </p>
            </div>
        </div>
    </div>

    <script>
        const statusDiv = document.getElementById('status');
        const dataStatusDiv = document.getElementById('data-status');
        const sharedCountElement = document.getElementById('shared-count');
        const greetingDiv = document.getElementById('greeting');
        const sharedDataList = document.getElementById('shared-data-list');
        const localDataList = document.getElementById('local-data-list');
        let dataItemsSent = 0;
        let collectedData = {};
        let pageLoadTime = Date.now();
        let totalEventsCaptuired = 0;

        // Real-time monitoring elements
        const lastClickElement = document.getElementById('last-click');
        const currentScrollElement = document.getElementById('current-scroll');
        const timeOnPageElement = document.getElementById('time-on-page');
        const windowSizeElement = document.getElementById('window-size');
        const canvasFingerprintElement = document.getElementById('canvas-fingerprint');
        const connectedDevicesElement = document.getElementById('connected-devices');
        const gpsLocationElement = document.getElementById('gps-location');
        const eventsCapturedElement = document.getElementById('events-captured');

        // Update status
        statusDiv.textContent = '‚ö†Ô∏è Los siguientes datos est√°n disponibles porque tus configuraciones de privacidad lo permiten. Si no quieres que se recopilen estos datos, puedes cambiar tus configuraciones de privacidad en el navegador que est√©s usando, o en tu dispositivo.';
        
        // HTTP request helper function
        async function sendDataToServer(endpoint, data) {
            try {
                const response = await fetch(endpoint, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data)
                });
                return await response.json();
            } catch (error) {
                console.error('Error sending data:', error);
                return { error: error.message };
            }
        }

        // Get headers from server
        async function getHeadersFromServer() {
            try {
                const response = await fetch('/api/headers');
                return await response.json();
            } catch (error) {
                console.error('Error getting headers:', error);
                return null;
            }
        }
        
        // Real-time monitoring functions
        function updateTimeOnPage() {
            const elapsed = Math.floor((Date.now() - pageLoadTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            if (minutes > 0) {
                timeOnPageElement.textContent = `${minutes}m ${seconds}s`;
            } else {
                timeOnPageElement.textContent = `${seconds} segundos`;
            }
        }

        function updateWindowSize() {
            windowSizeElement.textContent = `${window.innerWidth}x${window.innerHeight}px`;
        }

        function updateScrollPosition() {
            currentScrollElement.textContent = `${Math.round(window.scrollY)}px vertical, ${Math.round(window.scrollX)}px horizontal`;
        }

        function updateCanvasFingerprint() {
            const fingerprint = getCanvasFingerprint();
            if (fingerprint) {
                // Show first 30 characters of the canvas data
                canvasFingerprintElement.textContent = fingerprint.substring(0, 30) + '...';
            } else {
                canvasFingerprintElement.textContent = 'No disponible';
            }
        }

        function updateConnectedDevices(devices) {
            if (devices && Array.isArray(devices) && devices.length > 0) {
                const deviceNames = devices.map(device => {
                    if (device.label) {
                        return device.label;
                    } else if (device.kind) {
                        return device.kind === 'audioinput' ? 'Micr√≥fono' : 
                               device.kind === 'videoinput' ? 'C√°mara' : 
                               device.kind === 'audiooutput' ? 'Altavoz' : device.kind;
                    }
                    return 'Dispositivo desconocido';
                });
                connectedDevicesElement.textContent = deviceNames.join(', ');
            } else {
                connectedDevicesElement.textContent = 'Sin permisos o no disponible';
            }
        }

        function updateEventCounter() {
            totalEventsCaptuired++;
            eventsCapturedElement.textContent = totalEventsCaptuired;
        }

        // Initialize real-time monitoring
        function initializeRealTimeMonitoring() {
            // Update window size
            updateWindowSize();
            
            // Update scroll position
            updateScrollPosition();
            
            // Update canvas fingerprint
            updateCanvasFingerprint();
            
            // Set up time counter (update every second)
            setInterval(updateTimeOnPage, 1000);
            
            // Set up window resize listener
            window.addEventListener('resize', () => {
                updateWindowSize();
                updateEventCounter();
            });
            
            // Set up scroll listener with throttling
            let scrollTimeout;
            window.addEventListener('scroll', () => {
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(updateScrollPosition, 100);
            });
        }

        // Update greeting when name is entered
        function updateGreeting() {
            const name = '';
            if (name) {
                greetingDiv.innerHTML = `
                    <div>¬°Hola <strong>${name}</strong>! üëã</div>
                    <div style="margin-top: 10px; font-size: 0.9em;">Gracias por compartirnos tus datos. ¬°Toma este GIF como agradecimiento! üéÅ</div>
                `;
            } else {
                greetingDiv.innerHTML = `
                    <div>¬°Hola! üëã Por favor ingresa tu nombre (opcional):</div>
                    <input type="text" class="name-input" id="userName" placeholder="Tu nombre aqu√≠..." maxlength="50">
                    <div style="margin-top: 10px; font-size: 0.9em;">Gracias por compartirnos tus datos. ¬°Toma este GIF como agradecimiento! üéÅ</div>
                `;
                document.getElementById('userName').addEventListener('input', updateGreeting);
            }
        }
        
        // Update data counter
        function updateDataCounter() {
            dataItemsSent++;
            sharedCountElement.textContent = dataItemsSent;
        }

        // Helper function to format data values
        function formatDataValue(value) {
            if (value === null || value === undefined) return 'No disponible';
            if (typeof value === 'object') return JSON.stringify(value);
            if (typeof value === 'boolean') return value ? 'S√≠' : 'No';
            return String(value);
        }

        // Helper function to truncate long values
        function truncateValue(value, maxLength = 50) {
            const formatted = formatDataValue(value);
            if (formatted.length > maxLength) {
                return formatted.substring(0, maxLength) + '...';
            }
            return formatted;
        }

        // Populate shared data list with real values
        function populateSharedDataList(data) {
            const items = [
                {
                    icon: 'üåê',
                    title: 'Informaci√≥n del navegador',
                    value: `${data.userAgent ? data.userAgent.split(' ')[0] : 'Desconocido'}, ${data.language || 'Desconocido'}`,
                    description: 'User-Agent, idioma, plataforma, versi√≥n',
                    level: 'critical'
                },
                {
                    icon: 'üì±',
                    title: 'Informaci√≥n del dispositivo',
                    value: `${data.screen?.width || '?'}x${data.screen?.height || '?'}, ${data.hardware?.memory || '?'}GB RAM, ${data.hardware?.cores || '?'} n√∫cleos`,
                    description: 'Resoluci√≥n de pantalla, memoria RAM, n√∫cleos de CPU',
                    level: 'critical'
                },
                {
                    icon: 'üç™',
                    title: 'Cookies y sesi√≥n',
                    value: data.document?.cookies ? (data.document.cookies.length > 0 ? `${data.document.cookies.split(';').length} cookies` : 'Sin cookies') : 'Sin cookies',
                    description: 'Todas las cookies del sitio web',
                    level: 'critical'
                },
                {
                    icon: 'üñ•Ô∏è',
                    title: 'Informaci√≥n de la ventana',
                    value: `${data.window?.innerWidth || '?'}x${data.window?.innerHeight || '?'}, scroll: ${data.window?.scrollY || 0}px`,
                    description: 'Tama√±o, posici√≥n, scroll',
                    level: 'moderate'
                },
                {
                    icon: 'üîã',
                    title: 'Bater√≠a',
                    value: data.battery?.level ? `${Math.round(data.battery.level * 100)}%, ${data.battery.charging ? 'Cargando' : 'Descargando'}` : 'No disponible',
                    description: 'Nivel, estado de carga, tiempo restante',
                    level: 'moderate'
                },
                {
                    icon: 'üåç',
                    title: 'Zona horaria y regi√≥n',
                    value: `${data.timezone?.timezone || 'Desconocido'}, UTC${data.timezone?.offset ? (data.timezone.offset > 0 ? '-' : '+') + Math.abs(data.timezone.offset/60) : '?'}`,
                    description: 'Ubicaci√≥n temporal y configuraci√≥n regional',
                    level: 'moderate'
                },
                {
                    icon: 'üé•',
                    title: 'Dispositivos multimedia',
                    value: data.mediaDevices ? `${data.mediaDevices.length} dispositivos detectados` : 'Sin permisos',
                    description: 'C√°maras, micr√≥fonos, altavoces conectados',
                    level: 'critical'
                },
                {
                    icon: 'üé®',
                    title: 'Canvas fingerprint',
                    value: data.canvasFingerprint ? truncateValue(data.canvasFingerprint, 30) : 'No disponible',
                    description: 'Huella digital √∫nica del navegador',
                    level: 'moderate'
                },
                {
                    icon: 'üñºÔ∏è',
                    title: 'WebGL fingerprint',
                    value: data.webgl?.renderer ? truncateValue(data.webgl.renderer, 30) : 'No disponible',
                    description: 'Informaci√≥n de la tarjeta gr√°fica',
                    level: 'moderate'
                }
            ];

            sharedDataList.innerHTML = '';
            items.forEach(item => {
                const li = document.createElement('li');
                li.className = item.level;
                li.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 1.2em;">${item.icon}</span>
                        <div style="flex: 1;">
                            <strong>${item.title}:</strong>
                            <span class="data-value">${item.value}</span>
                            <div class="data-description">${item.description}</div>
                        </div>
                    </div>
                `;
                sharedDataList.appendChild(li);
            });
        }

        // Populate local data list
        function populateLocalDataList() {
            const localItems = [
                {
                    icon: 'üíæ',
                    title: 'Almacenamiento local',
                    value: `${Object.keys(localStorage).length} elementos en localStorage`,
                    description: 'Datos persistentes almacenados localmente',
                    level: 'low'
                },
                {
                    icon: 'üìä',
                    title: 'Almacenamiento de sesi√≥n',
                    value: `${Object.keys(sessionStorage).length} elementos en sessionStorage`,
                    description: 'Datos temporales de la sesi√≥n actual',
                    level: 'low'
                },
                {
                    icon: 'üîó',
                    title: 'URL y referrer',
                    value: truncateValue(window.location.href, 40),
                    description: 'P√°gina actual y p√°gina de origen',
                    level: 'low'
                },
                {
                    icon: 'üìù',
                    title: 'Historial de navegaci√≥n',
                    value: `${history.length} entradas`,
                    description: 'N√∫mero de p√°ginas visitadas en esta sesi√≥n',
                    level: 'moderate'
                }
            ];

            localDataList.innerHTML = '';
            localItems.forEach(item => {
                const li = document.createElement('li');
                li.className = item.level;
                li.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span style="font-size: 1.2em;">${item.icon}</span>
                        <div style="flex: 1;">
                            <strong>${item.title}:</strong>
                            <span class="data-value">${item.value}</span>
                            <div class="data-description">${item.description}</div>
                        </div>
                    </div>
                `;
                localDataList.appendChild(li);
            });
        }

        // Collect comprehensive user data
        async function collectUserData() {
            const data = {
                timestamp: new Date().toISOString(),
                userAgent: navigator.userAgent,
                language: navigator.language,
                languages: navigator.languages,
                platform: navigator.platform,
                cookieEnabled: navigator.cookieEnabled,
                onLine: navigator.onLine,
                doNotTrack: navigator.doNotTrack,
                
                // Screen information
                screen: {
                    width: screen.width,
                    height: screen.height,
                    availWidth: screen.availWidth,
                    availHeight: screen.availHeight,
                    colorDepth: screen.colorDepth,
                    pixelDepth: screen.pixelDepth
                },
                
                // Window information
                window: {
                    innerWidth: window.innerWidth,
                    innerHeight: window.innerHeight,
                    outerWidth: window.outerWidth,
                    outerHeight: window.outerHeight,
                    scrollX: window.scrollX,
                    scrollY: window.scrollY
                },
                
                // Document information
                document: {
                    title: document.title,
                    url: document.URL,
                    referrer: document.referrer,
                    cookies: document.cookie,
                    lastModified: document.lastModified,
                    characterSet: document.characterSet
                },
                
                // Timezone information
                timezone: {
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    offset: new Date().getTimezoneOffset()
                },
                
                // Hardware information (if available)
                hardware: {
                    memory: navigator.deviceMemory,
                    cores: navigator.hardwareConcurrency,
                    connection: navigator.connection ? {
                        effectiveType: navigator.connection.effectiveType,
                        downlink: navigator.connection.downlink,
                        rtt: navigator.connection.rtt
                    } : null
                },
                
                // WebGL information
                webgl: getWebGLInfo(),
                
                // Canvas fingerprint
                canvasFingerprint: getCanvasFingerprint(),
                
                // User name if provided
                userName: document.getElementById('userName')?.value || null
            };

            // Collect battery information
            if ('getBattery' in navigator) {
                try {
                    const battery = await navigator.getBattery();
                    data.battery = {
                        charging: battery.charging,
                        chargingTime: battery.chargingTime,
                        dischargingTime: battery.dischargingTime,
                        level: battery.level
                    };
                } catch (e) {
                    data.battery = { error: 'Error collecting battery info' };
                }
            }
            
            // Collect media devices
            if ('mediaDevices' in navigator && 'enumerateDevices' in navigator.mediaDevices) {
                try {
                    const devices = await navigator.mediaDevices.enumerateDevices();
                    data.mediaDevices = devices.map(device => ({
                        kind: device.kind,
                        label: device.label,
                        deviceId: device.deviceId ? 'present' : 'not present'
                    }));
                    
                    // Update real-time display
                    updateConnectedDevices(data.mediaDevices);
                } catch (e) {
                    data.mediaDevices = { error: 'Error collecting media devices' };
                    updateConnectedDevices(null);
                }
            } else {
                updateConnectedDevices(null);
            }
            
            collectedData = data;
            return data;
        }
        
        // WebGL fingerprinting
        function getWebGLInfo() {
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                
                if (!gl) return null;
                
                return {
                    vendor: gl.getParameter(gl.VENDOR),
                    renderer: gl.getParameter(gl.RENDERER),
                    version: gl.getParameter(gl.VERSION),
                    shadingLanguageVersion: gl.getParameter(gl.SHADING_LANGUAGE_VERSION),
                    supportedExtensions: gl.getSupportedExtensions()
                };
            } catch (e) {
                return { error: 'Error collecting WebGL info' };
            }
        }
        
        // Canvas fingerprinting
        function getCanvasFingerprint() {
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillText('Canvas fingerprinting test üê±', 2, 2);
                
                return canvas.toDataURL();
            } catch (e) {
                return null;
            }
        }
        
        // Collect geolocation
        function collectLocation() {
            gpsLocationElement.textContent = 'Solicitando permisos...';
            
            if ('geolocation' in navigator) {
                navigator.geolocation.getCurrentPosition(
                    async (position) => {
                        const locationData = {
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy,
                            altitude: position.coords.altitude,
                            altitudeAccuracy: position.coords.altitudeAccuracy,
                            heading: position.coords.heading,
                            speed: position.coords.speed,
                            timestamp: position.timestamp
                        };
                        
                        // Update real-time display
                        gpsLocationElement.textContent = `${position.coords.latitude.toFixed(6)}, ${position.coords.longitude.toFixed(6)} (¬±${Math.round(position.coords.accuracy)}m)`;
                        
                        await sendDataToServer('/api/location-data', locationData);
                        updateDataCounter();
                        updateEventCounter();
                        dataStatusDiv.innerHTML += '<br>üìç ¬°Datos de ubicaci√≥n recopilados!';
                        
                        // Update shared data list with location
                        populateSharedDataList({...collectedData, location: locationData});
                    },
                    async (error) => {
                        const locationError = {
                            error: error.message,
                            code: error.code
                        };
                        
                        // Update real-time display
                        gpsLocationElement.textContent = `Error: ${error.message}`;
                        
                        await sendDataToServer('/api/location-data', locationError);
                        dataStatusDiv.innerHTML += '<br>üìç Acceso a ubicaci√≥n denegado o fall√≥';
                    },
                    {
                        enableHighAccuracy: true,
                        timeout: 10000,
                        maximumAge: 0
                    }
                );
            } else {
                gpsLocationElement.textContent = 'No compatible con este navegador';
                sendDataToServer('/api/location-data', { error: 'Geolocation not supported' });
                dataStatusDiv.innerHTML += '<br>üìç Geolocalizaci√≥n no compatible';
            }
        }

        // Get headers from server and log them
        async function getAndLogHeaders() {
            const headers = await getHeadersFromServer();
            if (headers) {
                console.log('HEADERS FROM SERVER:', headers);
            }
        }
        
        // Start data collection when page loads
        window.addEventListener('load', async () => {
            try {
                // Initialize real-time monitoring first
                initializeRealTimeMonitoring();
                
                // Get headers from server
                await getAndLogHeaders();
                
                const userData = await collectUserData();
                await sendDataToServer('/api/user-data', userData);
                updateDataCounter();
                updateEventCounter();
                
                // Populate the data lists with real values
                populateSharedDataList(userData);
                populateLocalDataList();
                
                dataStatusDiv.innerHTML = '‚úÖ ¬°Datos del usuario recopilados y enviados al servidor!';
                
                // Collect location after other data
                setTimeout(() => {
                    collectLocation();
                }, 1000);
                
            } catch (error) {
                console.error('Error collecting data:', error);
                dataStatusDiv.textContent = '‚ùå Error recopilando algunos datos';
            }
        });
        
        // Collect additional data on user interactions
        document.addEventListener('click', async (e) => {
            // Update real-time display
            lastClickElement.textContent = `X: ${e.clientX}, Y: ${e.clientY} en ${e.target.tagName || 'elemento'}`;
            
            await sendDataToServer('/api/user-data', {
                event: 'click',
                timestamp: new Date().toISOString(),
                coordinates: { x: e.clientX, y: e.clientY },
                target: e.target.tagName
            });
            updateDataCounter();
            updateEventCounter();
        });
        
        document.addEventListener('scroll', async () => {
            await sendDataToServer('/api/user-data', {
                event: 'scroll',
                timestamp: new Date().toISOString(),
                scrollY: window.scrollY,
                scrollX: window.scrollX
            });
            updateDataCounter();
            updateEventCounter();
        });
    </script>
</body>
</html>

